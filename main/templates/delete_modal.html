<div id="deleteModal" class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-gray-800 bg-opacity-50">
    <div id="deleteModalContent" class="bg-white rounded-lg shadow-lg w-full max-w-sm p-6 opacity-0 scale-95 transition-all duration-300">
        <h3 class="text-xl font-semibold text-gray-900 mb-4">Confirm Deletion</h3>
        <p class="text-gray-700 mb-6">Are you sure you want to delete the product: "<b id="deleteProductName"></b>"? This action cannot be undone.</p>
        
        <input type="hidden" id="deleteProductId">

        <div class="flex justify-end gap-3">
            <button type="button" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors" onclick="hideDeleteModal()">
                Cancel
            </button>
            <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors" onclick="deleteProductAjax()">
                Delete
            </button>
        </div>
    </div>
</div>

<script>
    function showDeleteModal(productId, productName) {
        const modal = document.getElementById('deleteModal');
        const modalContent = document.getElementById('deleteModalContent');
        
        document.getElementById('deleteProductName').textContent = productName;
        document.getElementById('deleteProductId').value = productId;

        modal.classList.remove('hidden');
        setTimeout(() => {
            modalContent.classList.remove('opacity-0', 'scale-95');
            modalContent.classList.add('opacity-100', 'scale-100');
        }, 50);
    }

    function hideDeleteModal() {
        const modal = document.getElementById('deleteModal');
        const modalContent = document.getElementById('deleteModalContent');
        
        modalContent.classList.remove('opacity-100', 'scale-100');
        modalContent.classList.add('opacity-0', 'scale-95');

        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
    
    async function deleteProductAjax() {
        const productId = document.getElementById('deleteProductId').value;
        const url = `{% url 'main:delete_product_ajax' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', productId);

        try {
            const response = await fetch(url, {
                method: "DELETE",
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                }
            });

            if (!response.ok) {
                 throw new Error(`Server returned status: ${response.status}`);
            }

            hideDeleteModal();
            showToast('Product successfully deleted!', '', 'success');
            
            document.dispatchEvent(new CustomEvent('productUpdated'));

        } catch (error) {
            console.error('Deletion error:', error);
            showToast('Deletion Failed', 'Could not delete product. Please try again.', 'error', 4000);
        }
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                let cookie = cookies[i].trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>